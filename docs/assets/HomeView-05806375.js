import{c as J,d as G,r as D,g as Be,a as Y,b as Q,i as we,w as H,e as ne,o as le,f as se,n as te,h as i,j as F,t as T,m as A,k as be,l as Ue,p as M,I as N,q as ie,s as O,u as X,v as re,x as Ae,y as ee,z as Z,L as Fe,A as ye,B as V,C as ce,D as Oe,E as Ee,F as j,G as $e,H as Ye,J as Pe,K as xe,M as Ve,N as Ce,O as He,P as Ne,Q as Me,R as ue,S as W,T as de,U as Ze,V as Xe,W as me,X as je,Y as We}from"./index-83ec3282.js";import{s as Ge,S as qe,a as Ke}from"./index-a5820e5e.js";import{d as ve}from"./dayjs.min-40a0aa38.js";import{m as Se,u as Ie,a as Je,P as Qe,s as fe}from"./function-call-fed3c7eb.js";import{u as _e}from"./use-expose-25a6b7b7.js";import{L as pe}from"./index-48bbdba0.js";import{B as eo}from"./index-82f73bcf.js";const[oo,E]=J("image"),to={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:F,height:F,radius:F,lazyLoad:Boolean,iconSize:F,showError:T,errorIcon:A("photo-fail"),iconPrefix:String,showLoading:T,loadingIcon:A("photo")};var ao=G({name:oo,props:to,emits:["load","error"],setup(e,{emit:a,slots:s}){const o=D(!1),n=D(!0),m=D(),{$Lazyload:b}=Be().proxy,p=Y(()=>{const c={width:Q(e.width),height:Q(e.height)};return we(e.radius)&&(c.overflow="hidden",c.borderRadius=Q(e.radius)),c});H(()=>e.src,()=>{o.value=!1,n.value=!0});const w=c=>{n.value&&(n.value=!1,a("load",c))},u=()=>{const c=new Event("load");Object.defineProperty(c,"target",{value:m.value,enumerable:!0}),w(c)},v=c=>{o.value=!0,n.value=!1,a("error",c)},x=(c,k,d)=>d?d():i(N,{name:c,size:e.iconSize,class:k,classPrefix:e.iconPrefix},null),r=()=>{if(n.value&&e.showLoading)return i("div",{class:E("loading")},[x(e.loadingIcon,E("loading-icon"),s.loading)]);if(o.value&&e.showError)return i("div",{class:E("error")},[x(e.errorIcon,E("error-icon"),s.error)])},C=()=>{if(o.value||!e.src)return;const c={alt:e.alt,class:E("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?be(i("img",M({ref:m},c),null),[[Ue("lazy"),e.src]]):i("img",M({ref:m,src:e.src,onLoad:w,onError:v},c),null)},I=({el:c})=>{const k=()=>{c===m.value&&n.value&&u()};m.value?k():te(k)},y=({el:c})=>{c===m.value&&!o.value&&v()};return b&&ne&&(b.$on("loaded",I),b.$on("error",y),le(()=>{b.$off("loaded",I),b.$off("error",y)})),se(()=>{te(()=>{var c;(c=m.value)!=null&&c.complete&&!e.lazyLoad&&u()})}),()=>{var c;return i("div",{class:E({round:e.round,block:e.block}),style:p.value},[C(),r(),(c=s.default)==null?void 0:c.call(s)])}}});const ke=ie(ao);let ae;const no={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let lo=O({},no);function so(){({instance:ae}=Se({setup(){const{state:a,toggle:s}=Ie();return()=>i(Ge,M(a,{"onUpdate:show":s}),null)}}))}function io(e){return ne?new Promise((a,s)=>{ae||so(),ae.open(O({},lo,e,{callback:o=>{(o==="confirm"?a:s)(o)}}))}):Promise.resolve()}const ro=e=>io(O({showCancelButton:!0},e)),ge=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),oe=J("image-preview")[1];var co=G({props:{src:String,show:Boolean,active:Number,minZoom:X(F),maxZoom:X(F),rootWidth:X(Number),rootHeight:X(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:a,slots:s}){const o=re({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=Je(),m=D(),b=Y(()=>{const{rootWidth:l,rootHeight:g}=e,f=g/l;return o.imageRatio>f}),p=Y(()=>{const{scale:l,moveX:g,moveY:f,moving:L,zooming:U}=o,q={transitionDuration:U||L?"0s":".3s"};if(l!==1){const Re=g/l,Te=f/l;q.transform=`scale(${l}, ${l}) translate(${Re}px, ${Te}px)`}return q}),w=Y(()=>{if(o.imageRatio){const{rootWidth:l,rootHeight:g}=e,f=b.value?g/o.imageRatio:l;return Math.max(0,(o.scale*f-l)/2)}return 0}),u=Y(()=>{if(o.imageRatio){const{rootWidth:l,rootHeight:g}=e,f=b.value?g:l*o.imageRatio;return Math.max(0,(o.scale*f-g)/2)}return 0}),v=l=>{l=Z(l,+e.minZoom,+e.maxZoom+1),l!==o.scale&&(o.scale=l,a("scale",{scale:l,index:e.active}))},x=()=>{v(1),o.moveX=0,o.moveY=0},r=()=>{const l=o.scale>1?1:2;v(l),o.moveX=0,o.moveY=0};let C,I,y,c,k,d,R,t=!1;const h=l=>{const{touches:g}=l;if(C=g.length,C===2&&e.disableZoom)return;const{offsetX:f}=n;n.start(l),I=o.moveX,y=o.moveY,R=Date.now(),t=!1,o.moving=C===1&&o.scale!==1,o.zooming=C===2&&!f.value,o.zooming&&(c=o.scale,k=ge(l.touches))},_=l=>{const{touches:g}=l;if(n.move(l),o.moving){const{deltaX:f,deltaY:L}=n,U=f.value+I,q=L.value+y;if((U>w.value||U<-w.value)&&!t&&n.isHorizontal()){o.moving=!1;return}t=!0,ee(l,!0),o.moveX=Z(U,-w.value,w.value),o.moveY=Z(q,-u.value,u.value)}if(o.zooming&&(ee(l,!0),g.length===2)){const f=ge(g),L=c*f/k;v(L)}},S=()=>{if(C>1)return;const{offsetX:l,offsetY:g}=n,f=Date.now()-R,L=250,U=5;l.value<U&&g.value<U&&(f<L?d?(clearTimeout(d),d=null,r()):d=setTimeout(()=>{a("close"),d=null},L):f>Fe&&a("longPress"))},z=l=>{let g=!1;if((o.moving||o.zooming)&&(g=!0,o.moving&&I===o.moveX&&y===o.moveY&&(g=!1),!l.touches.length)){o.zooming&&(o.moveX=Z(o.moveX,-w.value,w.value),o.moveY=Z(o.moveY,-u.value,u.value),o.zooming=!1),o.moving=!1,I=0,y=0,c=1,o.scale<1&&x();const f=+e.maxZoom;o.scale>f&&(o.scale=f)}ee(l,g),S(),n.reset()},B=l=>{const{naturalWidth:g,naturalHeight:f}=l.target;o.imageRatio=f/g};return H(()=>e.active,x),H(()=>e.show,l=>{l||x()}),Ae("touchmove",_,{target:Y(()=>{var l;return(l=m.value)==null?void 0:l.$el})}),()=>{const l={loading:()=>i(pe,{type:"spinner"},null)};return i(qe,{ref:m,class:oe("swipe-item"),onTouchstartPassive:h,onTouchend:z,onTouchcancel:z},{default:()=>[s.image?i("div",{class:oe("image-wrap")},[s.image({src:e.src})]):i(ke,{src:e.src,fit:"contain",class:oe("image",{vertical:b.value}),style:p.value,onLoad:B},l)]})}}});const[uo,$]=J("image-preview"),mo=["show","teleport","transition","overlayStyle","closeOnPopstate"],vo={show:Boolean,loop:T,images:ye(),minZoom:V(1/3),maxZoom:V(3),overlay:T,closeable:Boolean,showIndex:T,className:ce,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:ce,overlayStyle:Object,swipeDuration:V(300),startPosition:V(0),showIndicators:Boolean,closeOnPopstate:T,closeIconPosition:A("top-right"),teleport:[String,Object]};var ze=G({name:uo,props:vo,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:a,slots:s}){const o=D(),n=re({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),m=()=>{if(o.value){const d=$e(o.value.$el);n.rootWidth=d.width,n.rootHeight=d.height,o.value.resize()}},b=d=>a("scale",d),p=d=>a("update:show",d),w=()=>{Pe(e.beforeClose,{args:[n.active],done:()=>p(!1)})},u=d=>{d!==n.active&&(n.active=d,a("change",d))},v=()=>{if(e.showIndex)return i("div",{class:$("index")},[s.index?s.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},x=()=>{if(s.cover)return i("div",{class:$("cover")},[s.cover()])},r=()=>{n.disableZoom=!0},C=()=>{n.disableZoom=!1},I=()=>i(Ke,{ref:o,lazyRender:!0,loop:e.loop,class:$("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u,onDragEnd:C,onDragStart:r},{default:()=>[e.images.map((d,R)=>i(co,{src:d,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,disableZoom:n.disableZoom,onScale:b,onClose:w,onLongPress:()=>a("longPress",{index:R})},{image:s.image}))]}),y=()=>{if(e.closeable)return i(N,{role:"button",name:e.closeIcon,class:[$("close-icon",e.closeIconPosition),Ye],onClick:w},null)},c=()=>a("closed"),k=(d,R)=>{var t;return(t=o.value)==null?void 0:t.swipeTo(d,R)};return _e({swipeTo:k}),se(m),H([Oe,Ee],m),H(()=>e.startPosition,d=>u(+d)),H(()=>e.show,d=>{const{images:R,startPosition:t}=e;d?(u(+t),te(()=>{m(),k(+t,{immediate:!0})})):a("close",{index:n.active,url:R[n.active]})}),()=>i(Qe,M({class:[$(),e.className],overlayClass:[$("overlay"),e.overlayClass],onClosed:c,"onUpdate:show":p},j(e,mo)),{default:()=>[y(),I(),v(),x()]})}});let K;const fo={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function go(){({instance:K}=Se({setup(){const{state:e,toggle:a}=Ie(),s=()=>{e.images=[]};return()=>i(ze,M(e,{onClosed:s,"onUpdate:show":a}),null)}}))}const ho=(e,a=0)=>{if(ne)return K||go(),e=Array.isArray(e)?{images:e,startPosition:a}:e,K.open(O({},fo,e)),K};ie(ze);const[wo,P,bo]=J("uploader");function he(e,a){return new Promise(s=>{if(a==="file"){s();return}const o=new FileReader;o.onload=n=>{s(n.target.result)},a==="dataUrl"?o.readAsDataURL(e):a==="text"&&o.readAsText(e)})}function Le(e,a){return xe(e).some(s=>s.file?Ve(a)?a(s.file):s.file.size>+a:!1)}function yo(e,a){const s=[],o=[];return e.forEach(n=>{Le(n,a)?o.push(n):s.push(n)}),{valid:s,invalid:o}}const Po=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,xo=e=>Po.test(e);function De(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?xo(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Co=G({props:{name:F,item:X(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:a,slots:s}){const o=()=>{const{status:u,message:v}=e.item;if(u==="uploading"||u==="failed"){const x=u==="failed"?i(N,{name:"close",class:P("mask-icon")},null):i(pe,{class:P("loading")},null),r=we(v)&&v!=="";return i("div",{class:P("mask")},[x,r&&i("div",{class:P("mask-message")},[v])])}},n=u=>{const{name:v,item:x,index:r,beforeDelete:C}=e;u.stopPropagation(),Pe(C,{args:[x,{name:v,index:r}],done:()=>a("delete")})},m=()=>a("preview"),b=()=>{if(e.deletable&&e.item.status!=="uploading"){const u=s["preview-delete"];return i("div",{role:"button",class:P("preview-delete",{shadow:!u}),tabindex:0,"aria-label":bo("delete"),onClick:n},[u?u():i(N,{name:"cross",class:P("preview-delete-icon")},null)])}},p=()=>{if(s["preview-cover"]){const{index:u,item:v}=e;return i("div",{class:P("preview-cover")},[s["preview-cover"](O({index:u},v))])}},w=()=>{const{item:u,lazyLoad:v,imageFit:x,previewSize:r}=e;return De(u)?i(ke,{fit:x,src:u.content||u.url,class:P("preview-image"),width:Array.isArray(r)?r[0]:r,height:Array.isArray(r)?r[1]:r,lazyLoad:v,onClick:m},{default:p}):i("div",{class:P("file"),style:Ce(e.previewSize)},[i(N,{class:P("file-icon"),name:"description"},null),i("div",{class:[P("file-name"),"van-ellipsis"]},[u.file?u.file.name:u.url]),p()])};return()=>i("div",{class:P("preview")},[w(),o(),b()])}});const So={name:V(""),accept:A("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:V(1/0),imageFit:A("cover"),resultType:A("dataUrl"),uploadIcon:A("photograph"),uploadText:String,deletable:T,afterRead:Function,showUpload:T,modelValue:ye(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:T,previewOptions:Object,previewFullImage:T,maxSize:{type:[Number,String,Function],default:1/0}};var Io=G({name:wo,props:So,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:a,slots:s}){const o=D(),n=[],m=(t=e.modelValue.length)=>({name:e.name,index:t}),b=()=>{o.value&&(o.value.value="")},p=t=>{if(b(),Le(t,e.maxSize))if(Array.isArray(t)){const h=yo(t,e.maxSize);if(t=h.valid,a("oversize",h.invalid,m()),!t.length)return}else{a("oversize",t,m());return}t=re(t),a("update:modelValue",[...e.modelValue,...xe(t)]),e.afterRead&&e.afterRead(t,m())},w=t=>{const{maxCount:h,modelValue:_,resultType:S}=e;if(Array.isArray(t)){const z=+h-_.length;t.length>z&&(t=t.slice(0,z)),Promise.all(t.map(B=>he(B,S))).then(B=>{const l=t.map((g,f)=>{const L={file:g,status:"",message:""};return B[f]&&(L.content=B[f]),L});p(l)})}else he(t,S).then(z=>{const B={file:t,status:"",message:""};z&&(B.content=z),p(B)})},u=t=>{const{files:h}=t.target;if(e.disabled||!h||!h.length)return;const _=h.length===1?h[0]:[].slice.call(h);if(e.beforeRead){const S=e.beforeRead(_,m());if(!S){b();return}if(Me(S)){S.then(z=>{w(z||_)}).catch(b);return}}w(_)};let v;const x=()=>a("closePreview"),r=t=>{if(e.previewFullImage){const h=e.modelValue.filter(De),_=h.map(S=>(S.file&&!S.url&&S.status!=="failed"&&(S.url=URL.createObjectURL(S.file),n.push(S.url)),S.url)).filter(Boolean);v=ho(O({images:_,startPosition:h.indexOf(t),onClose:x},e.previewOptions))}},C=()=>{v&&v.close()},I=(t,h)=>{const _=e.modelValue.slice(0);_.splice(h,1),a("update:modelValue",_),a("delete",t,m(h))},y=(t,h)=>{const _=["imageFit","deletable","previewSize","beforeDelete"],S=O(j(e,_),j(t,_,!0));return i(Co,M({item:t,index:h,onClick:()=>a("clickPreview",t,m(h)),onDelete:()=>I(t,h),onPreview:()=>r(t)},j(e,["name","lazyLoad"]),S),j(s,["preview-cover","preview-delete"]))},c=()=>{if(e.previewImage)return e.modelValue.map(y)},k=t=>a("clickUpload",t),d=()=>{if(e.modelValue.length>=+e.maxCount)return;const t=e.readonly?null:i("input",{ref:o,type:"file",class:P("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:u},null);return s.default?i("div",{class:P("input-wrapper"),onClick:k},[s.default(),t]):be(i("div",{class:P("upload",{readonly:e.readonly}),style:Ce(e.previewSize),onClick:k},[i(N,{name:e.uploadIcon,class:P("upload-icon")},null),e.uploadText&&i("span",{class:P("upload-text")},[e.uploadText]),t]),[[Ne,e.showUpload]])},R=()=>{o.value&&!e.disabled&&o.value.click()};return le(()=>{n.forEach(t=>URL.revokeObjectURL(t))}),_e({chooseFile:R,closeImagePreview:C}),He(()=>e.modelValue),()=>i("div",{class:P()},[i("div",{class:P("wrapper",{disabled:e.disabled})},[c(),d()])])}});const _o=ie(Io);const po={class:"home text-center"},ko={class:"mg20 text-color"},zo={class:"upload-box"},Lo=W("p",{class:"mg10"},"请上传音频文件：",-1),Do={key:0,class:"audio-resouse"},Ro=["src"],$o={__name:"HomeView",setup(e){We(r=>({"460359af":r.color}));const a=D(""),s=D(null),o=D(""),n=D(""),m=D([]);se(()=>{b()});const b=()=>{a.value=ve().format("YYYY-MM-DD HH:mm:ss"),s.value=setInterval(()=>{a.value=ve().format("YYYY-MM-DD HH:mm:ss")},1e3)},p=()=>{ro({title:"下载提示",message:"确实要下载吗？下载后请前往文件目录查看！！！"}).then(()=>{fe("下载");const r=m.value[0];w(r.file)}).catch(()=>{fe("取消下载")})},w=async r=>{if(r){const C=new Blob([r]),I=window.URL.createObjectURL(C),y=document.createElement("a");y.href=I,y.setAttribute("download",r.name),document.body.appendChild(y),y.click(),window.URL.revokeObjectURL(I),document.body.removeChild(y);return}},u=r=>(console.log(r,"file上传中"),r.status="uploading",r.message="上传中...",!0),v=r=>{console.log(r,"file上传成功"),n.value=r.file.name,o.value=URL.createObjectURL(r.file)},x=r=>{console.log(r,"file上传成功"),n.value="",o.value="",m.value=[]};return le(()=>{clearInterval(s)}),(r,C)=>{const I=_o,y=eo;return me(),ue("div",po,[W("p",ko,de(a.value),1),W("div",zo,[Lo,i(I,{modelValue:m.value,"onUpdate:modelValue":C[0]||(C[0]=c=>m.value=c),"max-count":1,"before-read":u,"after-read":v,"before-delete":x,accept:"audio/mp3"},null,8,["modelValue"])]),o.value?(me(),ue("div",Do,[W("span",null,de(n.value),1),W("audio",{src:o.value,controls:"",autoplay:!1},null,8,Ro),i(y,{type:"success",onClick:p},{default:Ze(()=>[je("下载")]),_:1})])):Xe("",!0)])}}};export{$o as default};
