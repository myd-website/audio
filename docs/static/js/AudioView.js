import{c as he,d as fe,r as F,g as qe,a as Q,b as we,i as Be,w as ne,e as De,o as Ce,f as Me,n as Se,h as m,j as G,t as E,m as X,k as ze,l as Je,p as ae,I as oe,q as Ie,s as ie,u as ce,v as Pe,x as Ke,y as ye,z as le,L as Qe,A as Ue,B as te,C as Oe,D as et,E as tt,F as de,G as nt,H as ot,J as Fe,K as Ye,M as at,N as Ne,O as it,P as st,Q as rt,_ as lt,R as ke,S as ee,T as ut,U as pe,V as $e,W as ct,X as Te,Y as dt,Z as ft}from"./index.js";import{C as mt}from"./index3.js";import"./index4.js";import{F as vt}from"./index5.js";import{s as ht,S as gt,a as wt}from"./index6.js";import{N as yt}from"./index7.js";import{m as Ve,u as He,a as pt,P as $t,s as ue}from"./function-call.js";import{u as Ee}from"./use-expose.js";import{L as We}from"./index8.js";import{B as bt}from"./index9.js";const[St,J]=he("image"),_t={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:G,height:G,radius:G,lazyLoad:Boolean,iconSize:G,showError:E,errorIcon:X("photo-fail"),iconPrefix:String,showLoading:E,loadingIcon:X("photo")};var xt=fe({name:St,props:_t,emits:["load","error"],setup(e,{emit:f,slots:v}){const n=F(!1),d=F(!0),x=F(),{$Lazyload:C}=qe().proxy,T=Q(()=>{const $={width:we(e.width),height:we(e.height)};return Be(e.radius)&&($.overflow="hidden",$.borderRadius=we(e.radius)),$});ne(()=>e.src,()=>{n.value=!1,d.value=!0});const M=$=>{d.value&&(d.value=!1,f("load",$))},h=()=>{const $=new Event("load");Object.defineProperty($,"target",{value:x.value,enumerable:!0}),M($)},I=$=>{n.value=!0,d.value=!1,f("error",$)},S=($,U,_)=>_?_():m(oe,{name:$,size:e.iconSize,class:U,classPrefix:e.iconPrefix},null),A=()=>{if(d.value&&e.showLoading)return m("div",{class:J("loading")},[S(e.loadingIcon,J("loading-icon"),v.loading)]);if(n.value&&e.showError)return m("div",{class:J("error")},[S(e.errorIcon,J("error-icon"),v.error)])},k=()=>{if(n.value||!e.src)return;const $={alt:e.alt,class:J("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?ze(m("img",ae({ref:x},$),null),[[Je("lazy"),e.src]]):m("img",ae({ref:x,src:e.src,onLoad:M,onError:I},$),null)},R=({el:$})=>{const U=()=>{$===x.value&&d.value&&h()};x.value?U():Se(U)},Y=({el:$})=>{$===x.value&&!n.value&&I()};return C&&De&&(C.$on("loaded",R),C.$on("error",Y),Ce(()=>{C.$off("loaded",R),C.$off("error",Y)})),Me(()=>{Se(()=>{var $;($=x.value)!=null&&$.complete&&!e.lazyLoad&&h()})}),()=>{var $;return m("div",{class:J({round:e.round,block:e.block}),style:T.value},[k(),A(),($=v.default)==null?void 0:$.call(v)])}}});const Ze=Ie(xt);let _e;const Dt={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let Ct=ie({},Dt);function Mt(){({instance:_e}=Ve({setup(){const{state:f,toggle:v}=He();return()=>m(ht,ae(f,{"onUpdate:show":v}),null)}}))}function It(e){return De?new Promise((f,v)=>{_e||Mt(),_e.open(ie({},Ct,e,{callback:n=>{(n==="confirm"?f:v)(n)}}))}):Promise.resolve()}const Ae=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),be=he("image-preview")[1];var Pt=fe({props:{src:String,show:Boolean,active:Number,minZoom:ce(G),maxZoom:ce(G),rootWidth:ce(Number),rootHeight:ce(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:f,slots:v}){const n=Pe({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),d=pt(),x=F(),C=Q(()=>{const{rootWidth:o,rootHeight:w}=e,g=w/o;return n.imageRatio>g}),T=Q(()=>{const{scale:o,moveX:w,moveY:g,moving:s,zooming:t}=n,a={transitionDuration:t||s?"0s":".3s"};if(o!==1){const l=w/o,i=g/o;a.transform=`scale(${o}, ${o}) translate(${l}px, ${i}px)`}return a}),M=Q(()=>{if(n.imageRatio){const{rootWidth:o,rootHeight:w}=e,g=C.value?w/n.imageRatio:o;return Math.max(0,(n.scale*g-o)/2)}return 0}),h=Q(()=>{if(n.imageRatio){const{rootWidth:o,rootHeight:w}=e,g=C.value?w:o*n.imageRatio;return Math.max(0,(n.scale*g-w)/2)}return 0}),I=o=>{o=le(o,+e.minZoom,+e.maxZoom+1),o!==n.scale&&(n.scale=o,f("scale",{scale:o,index:e.active}))},S=()=>{I(1),n.moveX=0,n.moveY=0},A=()=>{const o=n.scale>1?1:2;I(o),n.moveX=0,n.moveY=0};let k,R,Y,$,U,_,N,u=!1;const D=o=>{const{touches:w}=o;if(k=w.length,k===2&&e.disableZoom)return;const{offsetX:g}=d;d.start(o),R=n.moveX,Y=n.moveY,N=Date.now(),u=!1,n.moving=k===1&&n.scale!==1,n.zooming=k===2&&!g.value,n.zooming&&($=n.scale,U=Ae(o.touches))},r=o=>{const{touches:w}=o;if(d.move(o),n.moving){const{deltaX:g,deltaY:s}=d,t=g.value+R,a=s.value+Y;if((t>M.value||t<-M.value)&&!u&&d.isHorizontal()){n.moving=!1;return}u=!0,ye(o,!0),n.moveX=le(t,-M.value,M.value),n.moveY=le(a,-h.value,h.value)}if(n.zooming&&(ye(o,!0),w.length===2)){const g=Ae(w),s=$*g/U;I(s)}},c=()=>{if(k>1)return;const{offsetX:o,offsetY:w}=d,g=Date.now()-N,s=250,t=5;o.value<t&&w.value<t&&(g<s?_?(clearTimeout(_),_=null,A()):_=setTimeout(()=>{f("close"),_=null},s):g>Qe&&f("longPress"))},P=o=>{let w=!1;if((n.moving||n.zooming)&&(w=!0,n.moving&&R===n.moveX&&Y===n.moveY&&(w=!1),!o.touches.length)){n.zooming&&(n.moveX=le(n.moveX,-M.value,M.value),n.moveY=le(n.moveY,-h.value,h.value),n.zooming=!1),n.moving=!1,R=0,Y=0,$=1,n.scale<1&&S();const g=+e.maxZoom;n.scale>g&&(n.scale=g)}ye(o,w),c(),d.reset()},b=o=>{const{naturalWidth:w,naturalHeight:g}=o.target;n.imageRatio=g/w};return ne(()=>e.active,S),ne(()=>e.show,o=>{o||S()}),Ke("touchmove",r,{target:Q(()=>{var o;return(o=x.value)==null?void 0:o.$el})}),()=>{const o={loading:()=>m(We,{type:"spinner"},null)};return m(gt,{ref:x,class:be("swipe-item"),onTouchstartPassive:D,onTouchend:P,onTouchcancel:P},{default:()=>[v.image?m("div",{class:be("image-wrap")},[v.image({src:e.src})]):m(Ze,{src:e.src,fit:"contain",class:be("image",{vertical:C.value}),style:T.value,onLoad:b},o)]})}}});const[Ot,K]=he("image-preview"),kt=["show","teleport","transition","overlayStyle","closeOnPopstate"],Tt={show:Boolean,loop:E,images:Ue(),minZoom:te(1/3),maxZoom:te(3),overlay:E,closeable:Boolean,showIndex:E,className:Oe,closeIcon:X("clear"),transition:String,beforeClose:Function,overlayClass:Oe,overlayStyle:Object,swipeDuration:te(300),startPosition:te(0),showIndicators:Boolean,closeOnPopstate:E,closeIconPosition:X("top-right"),teleport:[String,Object]};var je=fe({name:Ot,props:Tt,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:f,slots:v}){const n=F(),d=Pe({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),x=()=>{if(n.value){const _=nt(n.value.$el);d.rootWidth=_.width,d.rootHeight=_.height,n.value.resize()}},C=_=>f("scale",_),T=_=>f("update:show",_),M=()=>{Fe(e.beforeClose,{args:[d.active],done:()=>T(!1)})},h=_=>{_!==d.active&&(d.active=_,f("change",_))},I=()=>{if(e.showIndex)return m("div",{class:K("index")},[v.index?v.index({index:d.active}):`${d.active+1} / ${e.images.length}`])},S=()=>{if(v.cover)return m("div",{class:K("cover")},[v.cover()])},A=()=>{d.disableZoom=!0},k=()=>{d.disableZoom=!1},R=()=>m(wt,{ref:n,lazyRender:!0,loop:e.loop,class:K("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:h,onDragEnd:k,onDragStart:A},{default:()=>[e.images.map((_,N)=>m(Pt,{src:_,show:e.show,active:d.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:d.rootWidth,rootHeight:d.rootHeight,disableZoom:d.disableZoom,onScale:C,onClose:M,onLongPress:()=>f("longPress",{index:N})},{image:v.image}))]}),Y=()=>{if(e.closeable)return m(oe,{role:"button",name:e.closeIcon,class:[K("close-icon",e.closeIconPosition),ot],onClick:M},null)},$=()=>f("closed"),U=(_,N)=>{var u;return(u=n.value)==null?void 0:u.swipeTo(_,N)};return Ee({swipeTo:U}),Me(x),ne([et,tt],x),ne(()=>e.startPosition,_=>h(+_)),ne(()=>e.show,_=>{const{images:N,startPosition:u}=e;_?(h(+u),Se(()=>{x(),U(+u,{immediate:!0})})):f("close",{index:d.active,url:N[d.active]})}),()=>m($t,ae({class:[K(),e.className],overlayClass:[K("overlay"),e.overlayClass],onClosed:$,"onUpdate:show":T},de(e,kt)),{default:()=>[Y(),R(),I(),S()]})}});let ve;const At={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Lt(){({instance:ve}=Ve({setup(){const{state:e,toggle:f}=He(),v=()=>{e.images=[]};return()=>m(je,ae(e,{onClosed:v,"onUpdate:show":f}),null)}}))}const Rt=(e,f=0)=>{if(De)return ve||Lt(),e=Array.isArray(e)?{images:e,startPosition:f}:e,ve.open(ie({},At,e)),ve};Ie(je);const[Bt,z,zt]=he("uploader");function Le(e,f){return new Promise(v=>{if(f==="file"){v();return}const n=new FileReader;n.onload=d=>{v(d.target.result)},f==="dataUrl"?n.readAsDataURL(e):f==="text"&&n.readAsText(e)})}function Xe(e,f){return Ye(e).some(v=>v.file?at(f)?f(v.file):v.file.size>+f:!1)}function Ut(e,f){const v=[],n=[];return e.forEach(d=>{Xe(d,f)?n.push(d):v.push(d)}),{valid:v,invalid:n}}const Ft=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,Yt=e=>Ft.test(e);function Ge(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?Yt(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Nt=fe({props:{name:G,item:ce(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:f,slots:v}){const n=()=>{const{status:h,message:I}=e.item;if(h==="uploading"||h==="failed"){const S=h==="failed"?m(oe,{name:"close",class:z("mask-icon")},null):m(We,{class:z("loading")},null),A=Be(I)&&I!=="";return m("div",{class:z("mask")},[S,A&&m("div",{class:z("mask-message")},[I])])}},d=h=>{const{name:I,item:S,index:A,beforeDelete:k}=e;h.stopPropagation(),Fe(k,{args:[S,{name:I,index:A}],done:()=>f("delete")})},x=()=>f("preview"),C=()=>{if(e.deletable&&e.item.status!=="uploading"){const h=v["preview-delete"];return m("div",{role:"button",class:z("preview-delete",{shadow:!h}),tabindex:0,"aria-label":zt("delete"),onClick:d},[h?h():m(oe,{name:"cross",class:z("preview-delete-icon")},null)])}},T=()=>{if(v["preview-cover"]){const{index:h,item:I}=e;return m("div",{class:z("preview-cover")},[v["preview-cover"](ie({index:h},I))])}},M=()=>{const{item:h,lazyLoad:I,imageFit:S,previewSize:A}=e;return Ge(h)?m(Ze,{fit:S,src:h.content||h.url,class:z("preview-image"),width:Array.isArray(A)?A[0]:A,height:Array.isArray(A)?A[1]:A,lazyLoad:I,onClick:x},{default:T}):m("div",{class:z("file"),style:Ne(e.previewSize)},[m(oe,{class:z("file-icon"),name:"description"},null),m("div",{class:[z("file-name"),"van-ellipsis"]},[h.file?h.file.name:h.url]),T()])};return()=>m("div",{class:z("preview")},[M(),n(),C()])}});const Vt={name:te(""),accept:X("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:te(1/0),imageFit:X("cover"),resultType:X("dataUrl"),uploadIcon:X("photograph"),uploadText:String,deletable:E,afterRead:Function,showUpload:E,modelValue:Ue(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:E,previewOptions:Object,previewFullImage:E,maxSize:{type:[Number,String,Function],default:1/0}};var Ht=fe({name:Bt,props:Vt,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:f,slots:v}){const n=F(),d=[],x=(u=e.modelValue.length)=>({name:e.name,index:u}),C=()=>{n.value&&(n.value.value="")},T=u=>{if(C(),Xe(u,e.maxSize))if(Array.isArray(u)){const D=Ut(u,e.maxSize);if(u=D.valid,f("oversize",D.invalid,x()),!u.length)return}else{f("oversize",u,x());return}u=Pe(u),f("update:modelValue",[...e.modelValue,...Ye(u)]),e.afterRead&&e.afterRead(u,x())},M=u=>{const{maxCount:D,modelValue:r,resultType:c}=e;if(Array.isArray(u)){const P=+D-r.length;u.length>P&&(u=u.slice(0,P)),Promise.all(u.map(b=>Le(b,c))).then(b=>{const o=u.map((w,g)=>{const s={file:w,status:"",message:""};return b[g]&&(s.content=b[g]),s});T(o)})}else Le(u,c).then(P=>{const b={file:u,status:"",message:""};P&&(b.content=P),T(b)})},h=u=>{const{files:D}=u.target;if(e.disabled||!D||!D.length)return;const r=D.length===1?D[0]:[].slice.call(D);if(e.beforeRead){const c=e.beforeRead(r,x());if(!c){C();return}if(rt(c)){c.then(P=>{M(P||r)}).catch(C);return}}M(r)};let I;const S=()=>f("closePreview"),A=u=>{if(e.previewFullImage){const D=e.modelValue.filter(Ge),r=D.map(c=>(c.file&&!c.url&&c.status!=="failed"&&(c.url=URL.createObjectURL(c.file),d.push(c.url)),c.url)).filter(Boolean);I=Rt(ie({images:r,startPosition:D.indexOf(u),onClose:S},e.previewOptions))}},k=()=>{I&&I.close()},R=(u,D)=>{const r=e.modelValue.slice(0);r.splice(D,1),f("update:modelValue",r),f("delete",u,x(D))},Y=(u,D)=>{const r=["imageFit","deletable","previewSize","beforeDelete"],c=ie(de(e,r),de(u,r,!0));return m(Nt,ae({item:u,index:D,onClick:()=>f("clickPreview",u,x(D)),onDelete:()=>R(u,D),onPreview:()=>A(u)},de(e,["name","lazyLoad"]),c),de(v,["preview-cover","preview-delete"]))},$=()=>{if(e.previewImage)return e.modelValue.map(Y)},U=u=>f("clickUpload",u),_=()=>{if(e.modelValue.length>=+e.maxCount)return;const u=e.readonly?null:m("input",{ref:n,type:"file",class:z("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:h},null);return v.default?m("div",{class:z("input-wrapper"),onClick:U},[v.default(),u]):ze(m("div",{class:z("upload",{readonly:e.readonly}),style:Ne(e.previewSize),onClick:U},[m(oe,{name:e.uploadIcon,class:z("upload-icon")},null),e.uploadText&&m("span",{class:z("upload-text")},[e.uploadText]),u]),[[st,e.showUpload]])},N=()=>{n.value&&!e.disabled&&n.value.click()};return Ce(()=>{d.forEach(u=>URL.revokeObjectURL(u))}),Ee({chooseFile:N,closeImagePreview:k}),it(()=>e.modelValue),()=>m("div",{class:z()},[m("div",{class:z("wrapper",{disabled:e.disabled})},[$(),_()])])}});const Et=Ie(Ht);var Wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},xe={},Zt={get exports(){return xe},set exports(e){xe=e}};(function(e,f){(function(v,n){e.exports=n()})(Wt,function(){var v=1e3,n=6e4,d=36e5,x="millisecond",C="second",T="minute",M="hour",h="day",I="week",S="month",A="quarter",k="year",R="date",Y="Invalid Date",$=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,U=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,_={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(s){var t=["th","st","nd","rd"],a=s%100;return"["+s+(t[(a-20)%10]||t[a]||t[0])+"]"}},N=function(s,t,a){var l=String(s);return!l||l.length>=t?s:""+Array(t+1-l.length).join(a)+s},u={s:N,z:function(s){var t=-s.utcOffset(),a=Math.abs(t),l=Math.floor(a/60),i=a%60;return(t<=0?"+":"-")+N(l,2,"0")+":"+N(i,2,"0")},m:function s(t,a){if(t.date()<a.date())return-s(a,t);var l=12*(a.year()-t.year())+(a.month()-t.month()),i=t.clone().add(l,S),p=a-i<0,y=t.clone().add(l+(p?-1:1),S);return+(-(l+(a-i)/(p?i-y:y-i))||0)},a:function(s){return s<0?Math.ceil(s)||0:Math.floor(s)},p:function(s){return{M:S,y:k,w:I,d:h,D:R,h:M,m:T,s:C,ms:x,Q:A}[s]||String(s||"").toLowerCase().replace(/s$/,"")},u:function(s){return s===void 0}},D="en",r={};r[D]=_;var c=function(s){return s instanceof w},P=function s(t,a,l){var i;if(!t)return D;if(typeof t=="string"){var p=t.toLowerCase();r[p]&&(i=p),a&&(r[p]=a,i=p);var y=t.split("-");if(!i&&y.length>1)return s(y[0])}else{var O=t.name;r[O]=t,i=O}return!l&&i&&(D=i),i||!l&&D},b=function(s,t){if(c(s))return s.clone();var a=typeof t=="object"?t:{};return a.date=s,a.args=arguments,new w(a)},o=u;o.l=P,o.i=c,o.w=function(s,t){return b(s,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var w=function(){function s(a){this.$L=P(a.locale,null,!0),this.parse(a)}var t=s.prototype;return t.parse=function(a){this.$d=function(l){var i=l.date,p=l.utc;if(i===null)return new Date(NaN);if(o.u(i))return new Date;if(i instanceof Date)return new Date(i);if(typeof i=="string"&&!/Z$/i.test(i)){var y=i.match($);if(y){var O=y[2]-1||0,B=(y[7]||"0").substring(0,3);return p?new Date(Date.UTC(y[1],O,y[3]||1,y[4]||0,y[5]||0,y[6]||0,B)):new Date(y[1],O,y[3]||1,y[4]||0,y[5]||0,y[6]||0,B)}}return new Date(i)}(a),this.$x=a.x||{},this.init()},t.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},t.$utils=function(){return o},t.isValid=function(){return this.$d.toString()!==Y},t.isSame=function(a,l){var i=b(a);return this.startOf(l)<=i&&i<=this.endOf(l)},t.isAfter=function(a,l){return b(a)<this.startOf(l)},t.isBefore=function(a,l){return this.endOf(l)<b(a)},t.$g=function(a,l,i){return o.u(a)?this[l]:this.set(i,a)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(a,l){var i=this,p=!!o.u(l)||l,y=o.p(a),O=function(q,H){var j=o.w(i.$u?Date.UTC(i.$y,H,q):new Date(i.$y,H,q),i);return p?j:j.endOf(h)},B=function(q,H){return o.w(i.toDate()[q].apply(i.toDate("s"),(p?[0,0,0,0]:[23,59,59,999]).slice(H)),i)},L=this.$W,V=this.$M,Z=this.$D,W="set"+(this.$u?"UTC":"");switch(y){case k:return p?O(1,0):O(31,11);case S:return p?O(1,V):O(0,V+1);case I:var se=this.$locale().weekStart||0,re=(L<se?L+7:L)-se;return O(p?Z-re:Z+(6-re),V);case h:case R:return B(W+"Hours",0);case M:return B(W+"Minutes",1);case T:return B(W+"Seconds",2);case C:return B(W+"Milliseconds",3);default:return this.clone()}},t.endOf=function(a){return this.startOf(a,!1)},t.$set=function(a,l){var i,p=o.p(a),y="set"+(this.$u?"UTC":""),O=(i={},i[h]=y+"Date",i[R]=y+"Date",i[S]=y+"Month",i[k]=y+"FullYear",i[M]=y+"Hours",i[T]=y+"Minutes",i[C]=y+"Seconds",i[x]=y+"Milliseconds",i)[p],B=p===h?this.$D+(l-this.$W):l;if(p===S||p===k){var L=this.clone().set(R,1);L.$d[O](B),L.init(),this.$d=L.set(R,Math.min(this.$D,L.daysInMonth())).$d}else O&&this.$d[O](B);return this.init(),this},t.set=function(a,l){return this.clone().$set(a,l)},t.get=function(a){return this[o.p(a)]()},t.add=function(a,l){var i,p=this;a=Number(a);var y=o.p(l),O=function(V){var Z=b(p);return o.w(Z.date(Z.date()+Math.round(V*a)),p)};if(y===S)return this.set(S,this.$M+a);if(y===k)return this.set(k,this.$y+a);if(y===h)return O(1);if(y===I)return O(7);var B=(i={},i[T]=n,i[M]=d,i[C]=v,i)[y]||1,L=this.$d.getTime()+a*B;return o.w(L,this)},t.subtract=function(a,l){return this.add(-1*a,l)},t.format=function(a){var l=this,i=this.$locale();if(!this.isValid())return i.invalidDate||Y;var p=a||"YYYY-MM-DDTHH:mm:ssZ",y=o.z(this),O=this.$H,B=this.$m,L=this.$M,V=i.weekdays,Z=i.months,W=function(H,j,ge,me){return H&&(H[j]||H(l,p))||ge[j].slice(0,me)},se=function(H){return o.s(O%12||12,H,"0")},re=i.meridiem||function(H,j,ge){var me=H<12?"AM":"PM";return ge?me.toLowerCase():me},q={YY:String(this.$y).slice(-2),YYYY:this.$y,M:L+1,MM:o.s(L+1,2,"0"),MMM:W(i.monthsShort,L,Z,3),MMMM:W(Z,L),D:this.$D,DD:o.s(this.$D,2,"0"),d:String(this.$W),dd:W(i.weekdaysMin,this.$W,V,2),ddd:W(i.weekdaysShort,this.$W,V,3),dddd:V[this.$W],H:String(O),HH:o.s(O,2,"0"),h:se(1),hh:se(2),a:re(O,B,!0),A:re(O,B,!1),m:String(B),mm:o.s(B,2,"0"),s:String(this.$s),ss:o.s(this.$s,2,"0"),SSS:o.s(this.$ms,3,"0"),Z:y};return p.replace(U,function(H,j){return j||q[H]||y.replace(":","")})},t.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},t.diff=function(a,l,i){var p,y=o.p(l),O=b(a),B=(O.utcOffset()-this.utcOffset())*n,L=this-O,V=o.m(this,O);return V=(p={},p[k]=V/12,p[S]=V,p[A]=V/3,p[I]=(L-B)/6048e5,p[h]=(L-B)/864e5,p[M]=L/d,p[T]=L/n,p[C]=L/v,p)[y]||L,i?V:o.a(V)},t.daysInMonth=function(){return this.endOf(S).$D},t.$locale=function(){return r[this.$L]},t.locale=function(a,l){if(!a)return this.$L;var i=this.clone(),p=P(a,l,!0);return p&&(i.$L=p),i},t.clone=function(){return o.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},s}(),g=w.prototype;return b.prototype=g,[["$ms",x],["$s",C],["$m",T],["$H",M],["$W",h],["$M",S],["$y",k],["$D",R]].forEach(function(s){g[s[1]]=function(t){return this.$g(t,s[0],s[1])}}),b.extend=function(s,t){return s.$i||(s(t,w,b),s.$i=!0),b},b.locale=P,b.isDayjs=c,b.unix=function(s){return b(1e3*s)},b.en=r[D],b.Ls=r,b.p={},b})})(Zt);const Re=xe;const jt=e=>(dt("data-v-b49d98a6"),e=e(),ft(),e),Xt={class:"home text-center"},Gt={class:"upload-box"},qt=jt(()=>ee("p",{class:"mg10"},"请上传音频文件：",-1)),Jt={key:0,class:"audio-resouse"},Kt=["src"],Qt={class:"audition"},en=["src"],tn={__name:"AudioView",setup(e){const f=F(""),v=F(null),n=F(""),d=F(""),x=F([]),C=F(""),T=F(null),M=F(null),h=new(window.AudioContext||window.webkitAudioContext),I=F(null);F(null);const S=F(null);Me(()=>{A()});const A=()=>{f.value=Re().format("YYYY-MM-DD HH:mm:ss"),v.value=setInterval(()=>{f.value=Re().format("YYYY-MM-DD HH:mm:ss")},1e3)},k=()=>{if(!S.value){ue("片段不能为空");return}It({title:"下载提示：浏览器打开进行下载",message:`
        <a href="${C.value}" id="linkText" target="_blank">https://myd-website.github.io/audio/</a>
        <input
          style="width: 100%;"
          class="customFileName"
          value="${S.value}"
          type="text"
          colon
          placeholder="请输入文件名称"
        />`,allowHtml:!0,theme:"round-button"}).then(()=>{const r=document.getElementsByClassName("customFileName")[0].value;if(r)S.value=r.includes("mp3")?r:`${r}.mp3`,R(),Y();else{ue("文件名称不能为空");return}})},R=async()=>{const r=document.createRange();r.selectNode(document.querySelector("#linkText"));const c=window.getSelection();c.rangeCount>0&&c.removeAllRanges(),c.addRange(r),document.execCommand("Copy"),ue("复制成功")},Y=r=>{const c=document.createElement("a");c.href=C.value,c.download=S.value,c.click()},$=r=>(console.log(r,"file上传中"),r.status="uploading",r.message="上传中...",!0),U=r=>{console.log(r,"file上传成功"),d.value=r.file.name,n.value=URL.createObjectURL(r.file),N(r.file)},_=r=>{console.log(r,"file上传成功"),d.value="",n.value="",x.value=[]},N=r=>{if(!r)return;const c=new FileReader;c.onload=async()=>{const P=c.result;I.value=await h.decodeAudioData(P)},c.readAsArrayBuffer(r)},u=async(r,c)=>{const P=x.value[0];if(!P.file){ue("请先选择一个音频文件");return}if(Number(r)>=Number(c)){ue("请输入有效的时间段");return}const b=new(window.AudioContext||window.webkitAudioContext),o=await P.file.arrayBuffer(),w=await b.decodeAudioData(o),g=b.createBuffer(w.numberOfChannels,(c-r)*w.sampleRate,w.sampleRate);for(let t=0;t<w.numberOfChannels;t++){const a=w.getChannelData(t);g.getChannelData(t).set(a.subarray(r*w.sampleRate,c*w.sampleRate))}const s=await D(g);C.value=URL.createObjectURL(s),S.value=`[${r}秒~${c}秒片段]_${d.value}`};function D(r){let c=r.numberOfChannels,P=r.length*c*2+44,b=0,o=new DataView(new ArrayBuffer(P)),w=[],g,s,t=0;for(l(1179011410),l(P-8),l(1163280727),l(544501094),l(16),a(1),a(c),l(r.sampleRate),l(r.sampleRate*2*c),a(c*2),a(16),l(1635017060),l(P-t-4),g=0;g<r.numberOfChannels;g++)w.push(r.getChannelData(g));for(;t<P;){for(g=0;g<c;g++)s=Math.max(-1,Math.min(1,w[g][b])),s=(.5+s<0?s*32768:s*32767)|0,o.setInt16(t,s,!0),t+=2;b++}return new Blob([o],{type:"audio/mp3"});function a(i){o.setUint16(t,i,!0),t+=2}function l(i){o.setUint32(t,i,!0),t+=4}}return Ce(()=>{clearInterval(v)}),(r,c)=>{const P=yt,b=Et,o=vt,w=mt,g=bt;return Te(),ke("div",Xt,[m(P,{"left-icon":"volume-o",text:`当前时间：${f.value}`},null,8,["text"]),ee("div",Gt,[qt,m(b,{modelValue:x.value,"onUpdate:modelValue":c[0]||(c[0]=s=>x.value=s),"max-count":1,"before-read":$,"after-read":U,"before-delete":_,accept:"audio/mp3"},null,8,["modelValue"])]),n.value?(Te(),ke("div",Jt,[ee("span",null,ut(d.value),1),ee("audio",{src:n.value,controls:"",autoplay:!1},null,8,Kt),m(w,{inset:""},{default:pe(()=>[m(o,{modelValue:T.value,"onUpdate:modelValue":c[1]||(c[1]=s=>T.value=s),type:"number",colon:"",placeholder:"请输入开始时间",label:"开始时间/秒"},null,8,["modelValue"]),m(o,{modelValue:M.value,"onUpdate:modelValue":c[2]||(c[2]=s=>M.value=s),type:"number",colon:"",placeholder:"请输入结束时间",label:"结束时间/秒"},null,8,["modelValue"])]),_:1}),m(g,{type:"success",onClick:c[3]||(c[3]=s=>u(T.value,M.value))},{default:pe(()=>[$e("截取片段")]),_:1}),ee("p",Qt,[$e(" 试听： "),ee("audio",{src:C.value,controls:"",autoplay:"false"},null,8,en)]),m(g,{type:"success",onClick:k},{default:pe(()=>[$e("下载")]),_:1})])):ct("",!0)])}}},mn=lt(tn,[["__scopeId","data-v-b49d98a6"]]);export{mn as default};
