import{c as he,d as de,r as F,g as Je,a as Q,b as we,i as Re,w as ne,e as xe,o as Ce,f as Me,n as Se,h as m,j as G,t as E,m as X,k as ze,l as qe,p as ae,I as oe,q as Ie,s as ie,u as ue,v as Pe,x as Ke,y as ye,z as le,L as Qe,A as Ue,B as te,C as Oe,D as et,E as tt,F as ce,G as nt,H as ot,J as Fe,K as Ye,M as at,N as Ne,O as it,P as st,Q as rt,_ as lt,R as ke,S as ee,T as ut,U as pe,V as $e,W as ct,X as Ae,Y as dt,Z as ft}from"./index.js";import{C as mt}from"./index3.js";import"./index4.js";import{F as vt}from"./index5.js";import{s as ht,S as gt,a as wt}from"./index6.js";import{N as yt}from"./index7.js";import{m as Ve,u as He,a as pt,P as $t,s as me}from"./function-call.js";import{u as Ee}from"./use-expose.js";import{L as Ze}from"./index8.js";import{B as bt}from"./index9.js";const[St,q]=he("image"),_t={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:G,height:G,radius:G,lazyLoad:Boolean,iconSize:G,showError:E,errorIcon:X("photo-fail"),iconPrefix:String,showLoading:E,loadingIcon:X("photo")};var Dt=de({name:St,props:_t,emits:["load","error"],setup(e,{emit:d,slots:v}){const o=F(!1),c=F(!0),x=F(),{$Lazyload:C}=Je().proxy,A=Q(()=>{const b={width:we(e.width),height:we(e.height)};return Re(e.radius)&&(b.overflow="hidden",b.borderRadius=we(e.radius)),b});ne(()=>e.src,()=>{o.value=!1,c.value=!0});const M=b=>{c.value&&(c.value=!1,d("load",b))},h=()=>{const b=new Event("load");Object.defineProperty(b,"target",{value:x.value,enumerable:!0}),M(b)},I=b=>{o.value=!0,c.value=!1,d("error",b)},S=(b,U,D)=>D?D():m(oe,{name:b,size:e.iconSize,class:U,classPrefix:e.iconPrefix},null),L=()=>{if(c.value&&e.showLoading)return m("div",{class:q("loading")},[S(e.loadingIcon,q("loading-icon"),v.loading)]);if(o.value&&e.showError)return m("div",{class:q("error")},[S(e.errorIcon,q("error-icon"),v.error)])},O=()=>{if(o.value||!e.src)return;const b={alt:e.alt,class:q("img"),style:{objectFit:e.fit,objectPosition:e.position}};return e.lazyLoad?ze(m("img",ae({ref:x},b),null),[[qe("lazy"),e.src]]):m("img",ae({ref:x,src:e.src,onLoad:M,onError:I},b),null)},B=({el:b})=>{const U=()=>{b===x.value&&c.value&&h()};x.value?U():Se(U)},Y=({el:b})=>{b===x.value&&!o.value&&I()};return C&&xe&&(C.$on("loaded",B),C.$on("error",Y),Ce(()=>{C.$off("loaded",B),C.$off("error",Y)})),Me(()=>{Se(()=>{var b;(b=x.value)!=null&&b.complete&&!e.lazyLoad&&h()})}),()=>{var b;return m("div",{class:q({round:e.round,block:e.block}),style:A.value},[O(),L(),(b=v.default)==null?void 0:b.call(v)])}}});const We=Ie(Dt);let _e;const xt={title:"",width:"",theme:null,message:"",overlay:!0,callback:null,teleport:"body",className:"",allowHtml:!1,lockScroll:!0,transition:void 0,beforeClose:null,overlayClass:"",overlayStyle:void 0,messageAlign:"",cancelButtonText:"",cancelButtonColor:null,cancelButtonDisabled:!1,confirmButtonText:"",confirmButtonColor:null,confirmButtonDisabled:!1,showConfirmButton:!0,showCancelButton:!1,closeOnPopstate:!0,closeOnClickOverlay:!1};let Ct=ie({},xt);function Mt(){({instance:_e}=Ve({setup(){const{state:d,toggle:v}=He();return()=>m(ht,ae(d,{"onUpdate:show":v}),null)}}))}function It(e){return xe?new Promise((d,v)=>{_e||Mt(),_e.open(ie({},Ct,e,{callback:o=>{(o==="confirm"?d:v)(o)}}))}):Promise.resolve()}const Le=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),be=he("image-preview")[1];var Pt=de({props:{src:String,show:Boolean,active:Number,minZoom:ue(G),maxZoom:ue(G),rootWidth:ue(Number),rootHeight:ue(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:d,slots:v}){const o=Pe({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),c=pt(),x=F(),C=Q(()=>{const{rootWidth:n,rootHeight:g}=e,w=g/n;return o.imageRatio>w}),A=Q(()=>{const{scale:n,moveX:g,moveY:w,moving:i,zooming:a}=o,t={transitionDuration:a||i?"0s":".3s"};if(n!==1){const f=g/n,s=w/n;t.transform=`scale(${n}, ${n}) translate(${f}px, ${s}px)`}return t}),M=Q(()=>{if(o.imageRatio){const{rootWidth:n,rootHeight:g}=e,w=C.value?g/o.imageRatio:n;return Math.max(0,(o.scale*w-n)/2)}return 0}),h=Q(()=>{if(o.imageRatio){const{rootWidth:n,rootHeight:g}=e,w=C.value?g:n*o.imageRatio;return Math.max(0,(o.scale*w-g)/2)}return 0}),I=n=>{n=le(n,+e.minZoom,+e.maxZoom+1),n!==o.scale&&(o.scale=n,d("scale",{scale:n,index:e.active}))},S=()=>{I(1),o.moveX=0,o.moveY=0},L=()=>{const n=o.scale>1?1:2;I(n),o.moveX=0,o.moveY=0};let O,B,Y,b,U,D,N,l=!1;const r=n=>{const{touches:g}=n;if(O=g.length,O===2&&e.disableZoom)return;const{offsetX:w}=c;c.start(n),B=o.moveX,Y=o.moveY,N=Date.now(),l=!1,o.moving=O===1&&o.scale!==1,o.zooming=O===2&&!w.value,o.zooming&&(b=o.scale,U=Le(n.touches))},u=n=>{const{touches:g}=n;if(c.move(n),o.moving){const{deltaX:w,deltaY:i}=c,a=w.value+B,t=i.value+Y;if((a>M.value||a<-M.value)&&!l&&c.isHorizontal()){o.moving=!1;return}l=!0,ye(n,!0),o.moveX=le(a,-M.value,M.value),o.moveY=le(t,-h.value,h.value)}if(o.zooming&&(ye(n,!0),g.length===2)){const w=Le(g),i=b*w/U;I(i)}},_=()=>{if(O>1)return;const{offsetX:n,offsetY:g}=c,w=Date.now()-N,i=250,a=5;n.value<a&&g.value<a&&(w<i?D?(clearTimeout(D),D=null,L()):D=setTimeout(()=>{d("close"),D=null},i):w>Qe&&d("longPress"))},k=n=>{let g=!1;if((o.moving||o.zooming)&&(g=!0,o.moving&&B===o.moveX&&Y===o.moveY&&(g=!1),!n.touches.length)){o.zooming&&(o.moveX=le(o.moveX,-M.value,M.value),o.moveY=le(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,B=0,Y=0,b=1,o.scale<1&&S();const w=+e.maxZoom;o.scale>w&&(o.scale=w)}ye(n,g),_(),c.reset()},$=n=>{const{naturalWidth:g,naturalHeight:w}=n.target;o.imageRatio=w/g};return ne(()=>e.active,S),ne(()=>e.show,n=>{n||S()}),Ke("touchmove",u,{target:Q(()=>{var n;return(n=x.value)==null?void 0:n.$el})}),()=>{const n={loading:()=>m(Ze,{type:"spinner"},null)};return m(gt,{ref:x,class:be("swipe-item"),onTouchstartPassive:r,onTouchend:k,onTouchcancel:k},{default:()=>[v.image?m("div",{class:be("image-wrap")},[v.image({src:e.src})]):m(We,{src:e.src,fit:"contain",class:be("image",{vertical:C.value}),style:A.value,onLoad:$},n)]})}}});const[Ot,K]=he("image-preview"),kt=["show","teleport","transition","overlayStyle","closeOnPopstate"],At={show:Boolean,loop:E,images:Ue(),minZoom:te(1/3),maxZoom:te(3),overlay:E,closeable:Boolean,showIndex:E,className:Oe,closeIcon:X("clear"),transition:String,beforeClose:Function,overlayClass:Oe,overlayStyle:Object,swipeDuration:te(300),startPosition:te(0),showIndicators:Boolean,closeOnPopstate:E,closeIconPosition:X("top-right"),teleport:[String,Object]};var je=de({name:Ot,props:At,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:d,slots:v}){const o=F(),c=Pe({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),x=()=>{if(o.value){const D=nt(o.value.$el);c.rootWidth=D.width,c.rootHeight=D.height,o.value.resize()}},C=D=>d("scale",D),A=D=>d("update:show",D),M=()=>{Fe(e.beforeClose,{args:[c.active],done:()=>A(!1)})},h=D=>{D!==c.active&&(c.active=D,d("change",D))},I=()=>{if(e.showIndex)return m("div",{class:K("index")},[v.index?v.index({index:c.active}):`${c.active+1} / ${e.images.length}`])},S=()=>{if(v.cover)return m("div",{class:K("cover")},[v.cover()])},L=()=>{c.disableZoom=!0},O=()=>{c.disableZoom=!1},B=()=>m(wt,{ref:o,lazyRender:!0,loop:e.loop,class:K("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:h,onDragEnd:O,onDragStart:L},{default:()=>[e.images.map((D,N)=>m(Pt,{src:D,show:e.show,active:c.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:c.rootWidth,rootHeight:c.rootHeight,disableZoom:c.disableZoom,onScale:C,onClose:M,onLongPress:()=>d("longPress",{index:N})},{image:v.image}))]}),Y=()=>{if(e.closeable)return m(oe,{role:"button",name:e.closeIcon,class:[K("close-icon",e.closeIconPosition),ot],onClick:M},null)},b=()=>d("closed"),U=(D,N)=>{var l;return(l=o.value)==null?void 0:l.swipeTo(D,N)};return Ee({swipeTo:U}),Me(x),ne([et,tt],x),ne(()=>e.startPosition,D=>h(+D)),ne(()=>e.show,D=>{const{images:N,startPosition:l}=e;D?(h(+l),Se(()=>{x(),U(+l,{immediate:!0})})):d("close",{index:c.active,url:N[c.active]})}),()=>m($t,ae({class:[K(),e.className],overlayClass:[K("overlay"),e.overlayClass],onClosed:b,"onUpdate:show":A},ce(e,kt)),{default:()=>[Y(),B(),I(),S()]})}});let ve;const Lt={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Tt(){({instance:ve}=Ve({setup(){const{state:e,toggle:d}=He(),v=()=>{e.images=[]};return()=>m(je,ae(e,{onClosed:v,"onUpdate:show":d}),null)}}))}const Bt=(e,d=0)=>{if(xe)return ve||Tt(),e=Array.isArray(e)?{images:e,startPosition:d}:e,ve.open(ie({},Lt,e)),ve};Ie(je);const[Rt,z,zt]=he("uploader");function Te(e,d){return new Promise(v=>{if(d==="file"){v();return}const o=new FileReader;o.onload=c=>{v(c.target.result)},d==="dataUrl"?o.readAsDataURL(e):d==="text"&&o.readAsText(e)})}function Xe(e,d){return Ye(e).some(v=>v.file?at(d)?d(v.file):v.file.size>+d:!1)}function Ut(e,d){const v=[],o=[];return e.forEach(c=>{Xe(c,d)?o.push(c):v.push(c)}),{valid:v,invalid:o}}const Ft=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,Yt=e=>Ft.test(e);function Ge(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?Yt(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Nt=de({props:{name:G,item:ue(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:d,slots:v}){const o=()=>{const{status:h,message:I}=e.item;if(h==="uploading"||h==="failed"){const S=h==="failed"?m(oe,{name:"close",class:z("mask-icon")},null):m(Ze,{class:z("loading")},null),L=Re(I)&&I!=="";return m("div",{class:z("mask")},[S,L&&m("div",{class:z("mask-message")},[I])])}},c=h=>{const{name:I,item:S,index:L,beforeDelete:O}=e;h.stopPropagation(),Fe(O,{args:[S,{name:I,index:L}],done:()=>d("delete")})},x=()=>d("preview"),C=()=>{if(e.deletable&&e.item.status!=="uploading"){const h=v["preview-delete"];return m("div",{role:"button",class:z("preview-delete",{shadow:!h}),tabindex:0,"aria-label":zt("delete"),onClick:c},[h?h():m(oe,{name:"cross",class:z("preview-delete-icon")},null)])}},A=()=>{if(v["preview-cover"]){const{index:h,item:I}=e;return m("div",{class:z("preview-cover")},[v["preview-cover"](ie({index:h},I))])}},M=()=>{const{item:h,lazyLoad:I,imageFit:S,previewSize:L}=e;return Ge(h)?m(We,{fit:S,src:h.content||h.url,class:z("preview-image"),width:Array.isArray(L)?L[0]:L,height:Array.isArray(L)?L[1]:L,lazyLoad:I,onClick:x},{default:A}):m("div",{class:z("file"),style:Ne(e.previewSize)},[m(oe,{class:z("file-icon"),name:"description"},null),m("div",{class:[z("file-name"),"van-ellipsis"]},[h.file?h.file.name:h.url]),A()])};return()=>m("div",{class:z("preview")},[M(),o(),C()])}});const Vt={name:te(""),accept:X("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:te(1/0),imageFit:X("cover"),resultType:X("dataUrl"),uploadIcon:X("photograph"),uploadText:String,deletable:E,afterRead:Function,showUpload:E,modelValue:Ue(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:E,previewOptions:Object,previewFullImage:E,maxSize:{type:[Number,String,Function],default:1/0}};var Ht=de({name:Rt,props:Vt,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:d,slots:v}){const o=F(),c=[],x=(l=e.modelValue.length)=>({name:e.name,index:l}),C=()=>{o.value&&(o.value.value="")},A=l=>{if(C(),Xe(l,e.maxSize))if(Array.isArray(l)){const r=Ut(l,e.maxSize);if(l=r.valid,d("oversize",r.invalid,x()),!l.length)return}else{d("oversize",l,x());return}l=Pe(l),d("update:modelValue",[...e.modelValue,...Ye(l)]),e.afterRead&&e.afterRead(l,x())},M=l=>{const{maxCount:r,modelValue:u,resultType:_}=e;if(Array.isArray(l)){const k=+r-u.length;l.length>k&&(l=l.slice(0,k)),Promise.all(l.map($=>Te($,_))).then($=>{const n=l.map((g,w)=>{const i={file:g,status:"",message:""};return $[w]&&(i.content=$[w]),i});A(n)})}else Te(l,_).then(k=>{const $={file:l,status:"",message:""};k&&($.content=k),A($)})},h=l=>{const{files:r}=l.target;if(e.disabled||!r||!r.length)return;const u=r.length===1?r[0]:[].slice.call(r);if(e.beforeRead){const _=e.beforeRead(u,x());if(!_){C();return}if(rt(_)){_.then(k=>{M(k||u)}).catch(C);return}}M(u)};let I;const S=()=>d("closePreview"),L=l=>{if(e.previewFullImage){const r=e.modelValue.filter(Ge),u=r.map(_=>(_.file&&!_.url&&_.status!=="failed"&&(_.url=URL.createObjectURL(_.file),c.push(_.url)),_.url)).filter(Boolean);I=Bt(ie({images:u,startPosition:r.indexOf(l),onClose:S},e.previewOptions))}},O=()=>{I&&I.close()},B=(l,r)=>{const u=e.modelValue.slice(0);u.splice(r,1),d("update:modelValue",u),d("delete",l,x(r))},Y=(l,r)=>{const u=["imageFit","deletable","previewSize","beforeDelete"],_=ie(ce(e,u),ce(l,u,!0));return m(Nt,ae({item:l,index:r,onClick:()=>d("clickPreview",l,x(r)),onDelete:()=>B(l,r),onPreview:()=>L(l)},ce(e,["name","lazyLoad"]),_),ce(v,["preview-cover","preview-delete"]))},b=()=>{if(e.previewImage)return e.modelValue.map(Y)},U=l=>d("clickUpload",l),D=()=>{if(e.modelValue.length>=+e.maxCount)return;const l=e.readonly?null:m("input",{ref:o,type:"file",class:z("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:h},null);return v.default?m("div",{class:z("input-wrapper"),onClick:U},[v.default(),l]):ze(m("div",{class:z("upload",{readonly:e.readonly}),style:Ne(e.previewSize),onClick:U},[m(oe,{name:e.uploadIcon,class:z("upload-icon")},null),e.uploadText&&m("span",{class:z("upload-text")},[e.uploadText]),l]),[[st,e.showUpload]])},N=()=>{o.value&&!e.disabled&&o.value.click()};return Ce(()=>{c.forEach(l=>URL.revokeObjectURL(l))}),Ee({chooseFile:N,closeImagePreview:O}),it(()=>e.modelValue),()=>m("div",{class:z()},[m("div",{class:z("wrapper",{disabled:e.disabled})},[b(),D()])])}});const Et=Ie(Ht);var Zt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},De={},Wt={get exports(){return De},set exports(e){De=e}};(function(e,d){(function(v,o){e.exports=o()})(Zt,function(){var v=1e3,o=6e4,c=36e5,x="millisecond",C="second",A="minute",M="hour",h="day",I="week",S="month",L="quarter",O="year",B="date",Y="Invalid Date",b=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,U=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,D={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(i){var a=["th","st","nd","rd"],t=i%100;return"["+i+(a[(t-20)%10]||a[t]||a[0])+"]"}},N=function(i,a,t){var f=String(i);return!f||f.length>=a?i:""+Array(a+1-f.length).join(t)+i},l={s:N,z:function(i){var a=-i.utcOffset(),t=Math.abs(a),f=Math.floor(t/60),s=t%60;return(a<=0?"+":"-")+N(f,2,"0")+":"+N(s,2,"0")},m:function i(a,t){if(a.date()<t.date())return-i(t,a);var f=12*(t.year()-a.year())+(t.month()-a.month()),s=a.clone().add(f,S),p=t-s<0,y=a.clone().add(f+(p?-1:1),S);return+(-(f+(t-s)/(p?s-y:y-s))||0)},a:function(i){return i<0?Math.ceil(i)||0:Math.floor(i)},p:function(i){return{M:S,y:O,w:I,d:h,D:B,h:M,m:A,s:C,ms:x,Q:L}[i]||String(i||"").toLowerCase().replace(/s$/,"")},u:function(i){return i===void 0}},r="en",u={};u[r]=D;var _=function(i){return i instanceof g},k=function i(a,t,f){var s;if(!a)return r;if(typeof a=="string"){var p=a.toLowerCase();u[p]&&(s=p),t&&(u[p]=t,s=p);var y=a.split("-");if(!s&&y.length>1)return i(y[0])}else{var P=a.name;u[P]=a,s=P}return!f&&s&&(r=s),s||!f&&r},$=function(i,a){if(_(i))return i.clone();var t=typeof a=="object"?a:{};return t.date=i,t.args=arguments,new g(t)},n=l;n.l=k,n.i=_,n.w=function(i,a){return $(i,{locale:a.$L,utc:a.$u,x:a.$x,$offset:a.$offset})};var g=function(){function i(t){this.$L=k(t.locale,null,!0),this.parse(t)}var a=i.prototype;return a.parse=function(t){this.$d=function(f){var s=f.date,p=f.utc;if(s===null)return new Date(NaN);if(n.u(s))return new Date;if(s instanceof Date)return new Date(s);if(typeof s=="string"&&!/Z$/i.test(s)){var y=s.match(b);if(y){var P=y[2]-1||0,R=(y[7]||"0").substring(0,3);return p?new Date(Date.UTC(y[1],P,y[3]||1,y[4]||0,y[5]||0,y[6]||0,R)):new Date(y[1],P,y[3]||1,y[4]||0,y[5]||0,y[6]||0,R)}}return new Date(s)}(t),this.$x=t.x||{},this.init()},a.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},a.$utils=function(){return n},a.isValid=function(){return this.$d.toString()!==Y},a.isSame=function(t,f){var s=$(t);return this.startOf(f)<=s&&s<=this.endOf(f)},a.isAfter=function(t,f){return $(t)<this.startOf(f)},a.isBefore=function(t,f){return this.endOf(f)<$(t)},a.$g=function(t,f,s){return n.u(t)?this[f]:this.set(s,t)},a.unix=function(){return Math.floor(this.valueOf()/1e3)},a.valueOf=function(){return this.$d.getTime()},a.startOf=function(t,f){var s=this,p=!!n.u(f)||f,y=n.p(t),P=function(J,H){var j=n.w(s.$u?Date.UTC(s.$y,H,J):new Date(s.$y,H,J),s);return p?j:j.endOf(h)},R=function(J,H){return n.w(s.toDate()[J].apply(s.toDate("s"),(p?[0,0,0,0]:[23,59,59,999]).slice(H)),s)},T=this.$W,V=this.$M,W=this.$D,Z="set"+(this.$u?"UTC":"");switch(y){case O:return p?P(1,0):P(31,11);case S:return p?P(1,V):P(0,V+1);case I:var se=this.$locale().weekStart||0,re=(T<se?T+7:T)-se;return P(p?W-re:W+(6-re),V);case h:case B:return R(Z+"Hours",0);case M:return R(Z+"Minutes",1);case A:return R(Z+"Seconds",2);case C:return R(Z+"Milliseconds",3);default:return this.clone()}},a.endOf=function(t){return this.startOf(t,!1)},a.$set=function(t,f){var s,p=n.p(t),y="set"+(this.$u?"UTC":""),P=(s={},s[h]=y+"Date",s[B]=y+"Date",s[S]=y+"Month",s[O]=y+"FullYear",s[M]=y+"Hours",s[A]=y+"Minutes",s[C]=y+"Seconds",s[x]=y+"Milliseconds",s)[p],R=p===h?this.$D+(f-this.$W):f;if(p===S||p===O){var T=this.clone().set(B,1);T.$d[P](R),T.init(),this.$d=T.set(B,Math.min(this.$D,T.daysInMonth())).$d}else P&&this.$d[P](R);return this.init(),this},a.set=function(t,f){return this.clone().$set(t,f)},a.get=function(t){return this[n.p(t)]()},a.add=function(t,f){var s,p=this;t=Number(t);var y=n.p(f),P=function(V){var W=$(p);return n.w(W.date(W.date()+Math.round(V*t)),p)};if(y===S)return this.set(S,this.$M+t);if(y===O)return this.set(O,this.$y+t);if(y===h)return P(1);if(y===I)return P(7);var R=(s={},s[A]=o,s[M]=c,s[C]=v,s)[y]||1,T=this.$d.getTime()+t*R;return n.w(T,this)},a.subtract=function(t,f){return this.add(-1*t,f)},a.format=function(t){var f=this,s=this.$locale();if(!this.isValid())return s.invalidDate||Y;var p=t||"YYYY-MM-DDTHH:mm:ssZ",y=n.z(this),P=this.$H,R=this.$m,T=this.$M,V=s.weekdays,W=s.months,Z=function(H,j,ge,fe){return H&&(H[j]||H(f,p))||ge[j].slice(0,fe)},se=function(H){return n.s(P%12||12,H,"0")},re=s.meridiem||function(H,j,ge){var fe=H<12?"AM":"PM";return ge?fe.toLowerCase():fe},J={YY:String(this.$y).slice(-2),YYYY:this.$y,M:T+1,MM:n.s(T+1,2,"0"),MMM:Z(s.monthsShort,T,W,3),MMMM:Z(W,T),D:this.$D,DD:n.s(this.$D,2,"0"),d:String(this.$W),dd:Z(s.weekdaysMin,this.$W,V,2),ddd:Z(s.weekdaysShort,this.$W,V,3),dddd:V[this.$W],H:String(P),HH:n.s(P,2,"0"),h:se(1),hh:se(2),a:re(P,R,!0),A:re(P,R,!1),m:String(R),mm:n.s(R,2,"0"),s:String(this.$s),ss:n.s(this.$s,2,"0"),SSS:n.s(this.$ms,3,"0"),Z:y};return p.replace(U,function(H,j){return j||J[H]||y.replace(":","")})},a.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},a.diff=function(t,f,s){var p,y=n.p(f),P=$(t),R=(P.utcOffset()-this.utcOffset())*o,T=this-P,V=n.m(this,P);return V=(p={},p[O]=V/12,p[S]=V,p[L]=V/3,p[I]=(T-R)/6048e5,p[h]=(T-R)/864e5,p[M]=T/c,p[A]=T/o,p[C]=T/v,p)[y]||T,s?V:n.a(V)},a.daysInMonth=function(){return this.endOf(S).$D},a.$locale=function(){return u[this.$L]},a.locale=function(t,f){if(!t)return this.$L;var s=this.clone(),p=k(t,f,!0);return p&&(s.$L=p),s},a.clone=function(){return n.w(this.$d,this)},a.toDate=function(){return new Date(this.valueOf())},a.toJSON=function(){return this.isValid()?this.toISOString():null},a.toISOString=function(){return this.$d.toISOString()},a.toString=function(){return this.$d.toUTCString()},i}(),w=g.prototype;return $.prototype=w,[["$ms",x],["$s",C],["$m",A],["$H",M],["$W",h],["$M",S],["$y",O],["$D",B]].forEach(function(i){w[i[1]]=function(a){return this.$g(a,i[0],i[1])}}),$.extend=function(i,a){return i.$i||(i(a,g,$),i.$i=!0),$},$.locale=k,$.isDayjs=_,$.unix=function(i){return $(1e3*i)},$.en=u[r],$.Ls=u,$.p={},$})})(Wt);const Be=De;const jt=e=>(dt("data-v-dbda5c78"),e=e(),ft(),e),Xt={class:"home text-center"},Gt={class:"upload-box"},Jt=jt(()=>ee("p",{class:"mg10"},"请上传音频文件：",-1)),qt={key:0,class:"audio-resouse"},Kt=["src"],Qt={class:"audition"},en=["src"],tn={__name:"AudioView",setup(e){const d=F(""),v=F(null),o=F(""),c=F(""),x=F([]),C=F(""),A=F(null),M=F(null),h=new(window.AudioContext||window.webkitAudioContext),I=F(null);F(null);const S=F(null);Me(()=>{L()});const L=()=>{d.value=Be().format("YYYY-MM-DD HH:mm:ss"),v.value=setInterval(()=>{d.value=Be().format("YYYY-MM-DD HH:mm:ss")},1e3)},O=()=>{if(!S.value){me("片段不能为空");return}It({title:"下载提示：浏览器打开进行下载",message:`
        <a href="${C.value}" target="_blank">https://myd-website.github.io/audio/</a>
        <input
          style="width: 100%;"
          class="customFileName"
          value="${S.value}"
          type="text"
          colon
          placeholder="请输入文件名称"
        />`,allowHtml:!0,theme:"round-button"}).then(()=>{const r=document.getElementsByClassName("customFileName")[0].value;if(r)S.value=r.includes("mp3")?r:`${r}.mp3`,B();else{me("文件名称不能为空");return}})},B=r=>{const u=document.createElement("a");u.href=C.value,u.download=S.value,u.click()},Y=r=>(console.log(r,"file上传中"),r.status="uploading",r.message="上传中...",!0),b=r=>{console.log(r,"file上传成功"),c.value=r.file.name,o.value=URL.createObjectURL(r.file),D(r.file)},U=r=>{console.log(r,"file上传成功"),c.value="",o.value="",x.value=[]},D=r=>{if(!r)return;const u=new FileReader;u.onload=async()=>{const _=u.result;I.value=await h.decodeAudioData(_)},u.readAsArrayBuffer(r)},N=async(r,u)=>{const _=x.value[0];if(!_.file){me("请先选择一个音频文件");return}if(Number(r)>=Number(u)){me("请输入有效的时间段");return}const k=new(window.AudioContext||window.webkitAudioContext),$=await _.file.arrayBuffer(),n=await k.decodeAudioData($),g=k.createBuffer(n.numberOfChannels,(u-r)*n.sampleRate,n.sampleRate);for(let i=0;i<n.numberOfChannels;i++){const a=n.getChannelData(i);g.getChannelData(i).set(a.subarray(r*n.sampleRate,u*n.sampleRate))}const w=await l(g);C.value=URL.createObjectURL(w),S.value=`[${r}秒~${u}秒片段]_${c.value}`};function l(r){let u=r.numberOfChannels,_=r.length*u*2+44,k=0,$=new DataView(new ArrayBuffer(_)),n=[],g,w,i=0;for(t(1179011410),t(_-8),t(1163280727),t(544501094),t(16),a(1),a(u),t(r.sampleRate),t(r.sampleRate*2*u),a(u*2),a(16),t(1635017060),t(_-i-4),g=0;g<r.numberOfChannels;g++)n.push(r.getChannelData(g));for(;i<_;){for(g=0;g<u;g++)w=Math.max(-1,Math.min(1,n[g][k])),w=(.5+w<0?w*32768:w*32767)|0,$.setInt16(i,w,!0),i+=2;k++}return new Blob([$],{type:"audio/mp3"});function a(f){$.setUint16(i,f,!0),i+=2}function t(f){$.setUint32(i,f,!0),i+=4}}return Ce(()=>{clearInterval(v)}),(r,u)=>{const _=yt,k=Et,$=vt,n=mt,g=bt;return Ae(),ke("div",Xt,[m(_,{"left-icon":"volume-o",text:`当前时间：${d.value}`},null,8,["text"]),ee("div",Gt,[Jt,m(k,{modelValue:x.value,"onUpdate:modelValue":u[0]||(u[0]=w=>x.value=w),"max-count":1,"before-read":Y,"after-read":b,"before-delete":U,accept:"audio/mp3"},null,8,["modelValue"])]),o.value?(Ae(),ke("div",qt,[ee("span",null,ut(c.value),1),ee("audio",{src:o.value,controls:"",autoplay:!1},null,8,Kt),m(n,{inset:""},{default:pe(()=>[m($,{modelValue:A.value,"onUpdate:modelValue":u[1]||(u[1]=w=>A.value=w),type:"number",colon:"",placeholder:"请输入开始时间",label:"开始时间/秒"},null,8,["modelValue"]),m($,{modelValue:M.value,"onUpdate:modelValue":u[2]||(u[2]=w=>M.value=w),type:"number",colon:"",placeholder:"请输入结束时间",label:"结束时间/秒"},null,8,["modelValue"])]),_:1}),m(g,{type:"success",onClick:u[3]||(u[3]=w=>N(A.value,M.value))},{default:pe(()=>[$e("截取片段")]),_:1}),ee("p",Qt,[$e(" 试听： "),ee("audio",{src:C.value,controls:"",autoplay:"false"},null,8,en)]),m(g,{type:"success",onClick:O},{default:pe(()=>[$e("下载")]),_:1})])):ct("",!0)])}}},mn=lt(tn,[["__scopeId","data-v-dbda5c78"]]);export{mn as default};
